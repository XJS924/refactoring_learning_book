#### 第七章 在对象之间搬移特性

##### 7.1 Move Method(搬移函数)

你的程序中，有个函数与其所驻类之外的另一个类进行更多的交流，调用后者或被后者调用。

**在该函数最常引用的类中建立一个有着类似行为的新函数。将就函数变成一个单纯的委托函数，或是将旧函数完全移除**

**动机**

- 如果一个类有太多行为，或如果一个类与另一个类有太多合作而形成高度耦合，我就会搬移函数。

**做法**

- 检查源类中被源函数所使用的一切特性(包含字段和函数)，考虑他们是否也该被搬移。

  > 如果某个特性制备你打算搬移的那个函数用到，就应该将它一并搬移。如果另有其他函数使用了这个特性，你可以考虑将使用该特性的所有函数全都一并搬移。有时候，搬移一组函数比注意搬移简单些。

- 检查源类的子类和超类，看看是否有该函数的其他声明。

  > 如果出现其他声明，你或许无法进行搬移，除非目标类也同样出现多态性。

- 在目标类中声明这个函数。

  > 你可以为此函数选择一个新名词—对目标类更有意义的名称。

- 将原函数的代码复制到目标函数中，调整后者，使其能在新家中正常运行。

  > 如果目标函数使用了源类中的特性，你得决定如何从目标函数引用源对象。如果目标类中没有相应的引用机制，就把源对象的引用当做参数，传给新建立的目标函数。

  > 如果原函数包含异常处理，你得判断逻辑上应该由哪个类来处理这一异常。如果应该由源类来负责，就把异常处理留在原地。

- 编译目标类

- 决定如何从原函数正确引用目标对象

  > 可能会有一个现成的字段或函数帮助你取得目标对象。如果没有，就看能否轻松建立一个这样的函数。如果还是不行，就得在源类中新建一个字段来保存目标对象，这可能是一个永久性修改，但你也可以让他是暂时的。因为后继的其他重构项目可能会把这个新建字段去掉。

- 修改原函数，使之成为一个纯委托函数。

- 编译测试。

- 决定是否删除原函数，或是将它当做一个委托函数保留下来。

  > 如果你经常要在源对象中引用目标函数，那么将原函数作为委托函数保留下来会比较简单。

- 如果要移除原函数，请将源类中对原函数的所有调用，替换成对目标函数的调用。

  > 你可以没修改一个引用点就编译并测试一次，也可以通过一次“查找、替换”改掉所有引用点，这通常会简单一些。

- 编译测试。

- 

